<form [formGroup]="productSpecificAttributeForm" (ngSubmit)="onSubmit()">
    <div class="product-specific-attribute-container">
        <div class="title">
            <h2>产品私有属性</h2>
            <button mat-raised-button [matMenuTriggerFor]="menu">添加属性
                <mat-icon fontIcon="arrow_drop_down"></mat-icon>
            </button>
            <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="addAttribute('SELECT')">普通文本</button>
                <button mat-menu-item (click)="addAttribute('TEXT')">文本区</button>
                <button mat-menu-item (click)="addAttribute('CHECKBOX')">是/否</button>
            </mat-menu>
        </div>
        @if (attributes.length === 0) {
            <p>该产品暂无私有属性</p>
        } @else {
            <div class="content" formArrayName="attributes">
                @for (attribute of attributes.controls;track attributeIdx;let attributeIdx =$index) {
                    <div class="attribute" [formGroupName]="attributeIdx">
                        <input matNativeControl placeholder="属性名称" formControlName="name">
                        @switch (attribute.controls.attributeType.value) {
                            <!-- select -->
                            @case ('SELECT') {
                                <div formArrayName="attributeOptions">
                                    @for (attributeOption of attribute.controls.attributeOptions?.controls;track attributeOptionIdx;let attributeOptionIdx=$index) {
                                        <div class="attribute-option" [formGroupName]="attributeOptionIdx">
                                            <input matNativeControl
                                                   (blur)="checkbox.checked&&addAttributeOption(attribute)"
                                                   placeholder="属性选项" formControlName="name">
                                            @if (!$first) {
                                                <mat-icon class="hide" fontIcon="delete"
                                                          (click)="deleteAttributeOption(attributeIdx,attributeOptionIdx)"></mat-icon>
                                            }
                                        </div>
                                    }
                                </div>
                                <mat-checkbox #checkbox [checked]="false"
                                              [ngClass]="{'hide':!checkbox.checked}"
                                              aria-label="multiple value">
                                    多值
                                </mat-checkbox>
                            }
                            <!--  checkbox -->
                            @case ('CHECKBOX') {
                                @if (checkbox.checked) {
                                    <input matNativeControl type="text" value="true" [readonly]="true">
                                    <input matNativeControl type="text" value="false" [readonly]="true">
                                } @else {
                                    <select matNativeControl>
                                        <option value="true" selected>是</option>
                                        <option value="false">否</option>
                                    </select>
                                }

                                <mat-checkbox #checkbox [checked]="false"
                                              [ngClass]="{'hide':!checkbox.checked}"
                                              aria-label="multiple value">
                                    多值
                                </mat-checkbox>
                            }
                            <!--  text -->
                            @case ('TEXT') {
                                <textarea matNativeControl placeholder="文本区"></textarea>
                            }
                        }
                        <mat-icon fontIcon="delete" (click)="deleteAttribute(attributeIdx)"></mat-icon>
                    </div>
                }

            </div>

        }
    </div>
    <page-footer>
        <ng-container buttons>
            <button mat-raised-button type="submit"
                    [disabled]="productSpecificAttributeForm.invalid&&productSpecificAttributeForm.pristine">保存
            </button>
        </ng-container>
    </page-footer>
</form>